
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Profile</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            // Custom theme extensions can go here
          },
        },
      };
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Inter', sans-serif;
      }
      .font-cairo {
        font-family: 'Cairo', sans-serif;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script type="importmap">
      {
        "imports": {
          "react": "https://esm.sh/react@18.2.0",
          "react-dom/client": "https://esm.sh/react-dom@18.2.0/client"
        }
      }
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module">
      import React, { useState, useEffect, useCallback, useRef } from 'react';
      import ReactDOM from 'react-dom/client';
      
      // --- Supabase Client Initialization ---
      const { createClient } = supabase;
      const supabaseClient = createClient(
        "https://jxlcchbvawbkmzfigqmd.supabase.co",
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp4bGNjaGJ2YXdia216ZmlncW1kIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg0ODA5OTgsImV4cCI6MjA3NDA1Njk5OH0.VBMshOHnWYkdSeDZ6asGwO2CaROp_tgQncQ-EWXF-ho"
      );

      // --- From countries.ts ---
      const countries = [
        "Afghanistan", "Albania", "Algeria", "Andorra", "Angola", "Antigua and Barbuda", "Argentina", "Armenia", "Australia", "Austria", "Azerbaijan",
        "Bahamas", "Bahrain", "Bangladesh", "Barbados", "Belarus", "Belgium", "Belize", "Benin", "Bhutan", "Bolivia", "Bosnia and Herzegovina", "Botswana", "Brazil", "Brunei", "Bulgaria", "Burkina Faso", "Burundi",
        "Cabo Verde", "Cambodia", "Cameroon", "Canada", "Central African Republic", "Chad", "Chile", "China", "Colombia", "Comoros", "Congo, Democratic Republic of the", "Congo, Republic of the", "Costa Rica", "Cote d'Ivoire", "Croatia", "Cuba", "Cyprus", "Czech Republic",
        "Denmark", "Djibouti", "Dominica", "Dominican Republic",
        "Ecuador", "Egypt", "El Salvador", "Equatorial Guinea", "Eritrea", "Estonia", "Eswatini", "Ethiopia",
        "Fiji", "Finland", "France",
        "Gabon", "Gambia", "Georgia", "Germany", "Ghana", "Greece", "Grenada", "Guatemala", "Guinea", "Guinea-Bissau", "Guyana",
        "Haiti", "Honduras", "Hungary",
        "Iceland", "India", "Indonesia", "Iran", "Iraq", "Ireland", "Israel", "Italy",
        "Jamaica", "Japan", "Jordan",
        "Kazakhstan", "Kenya", "Kiribati", "Kosovo", "Kuwait", "Kyrgyzstan",
        "Laos", "Latvia", "Lebanon", "Lesotho", "Liberia", "Libya", "Liechtenstein", "Lithuania", "Luxembourg",
        "Madagascar", "Malawi", "Malaysia", "Maldives", "Mali", "Malta", "Marshall Islands", "Mauritania", "Mauritius", "Mexico", "Micronesia", "Moldova", "Monaco", "Mongolia", "Montenegro", "Morocco", "Mozambique", "Myanmar",
        "Namibia", "Nauru", "Nepal", "Netherlands", "New Zealand", "Nicaragua", "Niger", "Nigeria", "North Korea", "North Macedonia", "Norway",
        "Oman",
        "Pakistan", "Palau", "Palestine State", "Panama", "Papua New Guinea", "Paraguay", "Peru", "Philippines", "Poland", "Portugal",
        "Qatar",
        "Romania", "Russia", "Rwanda",
        "Saint Kitts and Nevis", "Saint Lucia", "Saint Vincent and the Grenadines", "Samoa", "San Marino", "Sao Tome and Principe", "Saudi Arabia", "Senegal", "Serbia", "Seychelles", "Sierra Leone", "Singapore", "Slovakia", "Slovenia", "Solomon Islands", "Somalia", "South Africa", "South Korea", "South Sudan", "Spain", "Sri Lanka", "Sudan", "Suriname", "Sweden", "Switzerland", "Syria",
        "Taiwan", "Tajikistan", "Tanzania", "Thailand", "Timor-Leste", "Togo", "Tonga", "Trinidad and Tobago", "Tunisia", "Turkey", "Turkmenistan", "Tuvalu",
        "Uganda", "Ukraine", "United Arab Emirates", "United Kingdom", "United States of America", "Uruguay", "Uzbekistan",
        "Vanuatu", "Vatican City", "Venezuela", "Vietnam",
        "Yemen", "Zambia", "Zimbabwe"
      ];

      // --- From components/ThemeToggle.tsx ---
      const SunIcon = () => (
          React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", className: "h-6 w-6", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor" },
              React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" })
          )
      );

      const MoonIcon = () => (
          React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", className: "h-6 w-6", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor" },
              React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" })
          )
      );

      const ThemeToggle = ({ theme, toggleTheme }) => {
        return (
          React.createElement('button', {
            onClick: toggleTheme,
            className: "p-2 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 dark:focus:ring-offset-gray-900",
            'aria-label': `Switch to ${theme === 'light' ? 'dark' : 'light'} mode`
          },
          theme === 'light' ? React.createElement(MoonIcon) : React.createElement(SunIcon))
        );
      };

      // --- From components/UserDropdown.tsx ---
      const UserDropdown = ({ user }) => {
        const [isOpen, setIsOpen] = useState(false);
        const dropdownRef = useRef(null);

        useEffect(() => {
          const handleClickOutside = (event) => {
            if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {
              setIsOpen(false);
            }
          };
          document.addEventListener('mousedown', handleClickOutside);
          return () => document.removeEventListener('mousedown', handleClickOutside);
        }, []);

        const handleLogout = async () => {
          await supabaseClient.auth.signOut();
          window.location.href = window.location.origin + "/Vionex-/login.html";
        };
        
        const handleSettings = () => {
          // Can be implemented in the future
          setIsOpen(false);
        };

        return (
          React.createElement('div', { className: "relative", ref: dropdownRef },
            React.createElement('button', { onClick: () => setIsOpen(!isOpen), className: "flex items-center space-x-2 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 rounded-full" },
              React.createElement('img', {
                src: user.avatarUrl,
                alt: "User avatar",
                className: "w-10 h-10 rounded-full object-cover"
              }),
              React.createElement('div', { className: "hidden lg:block text-left" },
                  React.createElement('p', { className: "font-semibold text-sm text-gray-800 dark:text-gray-200" }, user.name),
                  React.createElement('p', { className: "text-xs text-gray-500 dark:text-gray-400" }, "Account")
              ),
               React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", className: `h-5 w-5 text-gray-500 dark:text-gray-400 transition-transform ${isOpen ? 'rotate-180' : ''}`, viewBox: "0 0 20 20", fill: "currentColor" },
                  React.createElement('path', { fillRule: "evenodd", d: "M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z", clipRule: "evenodd" })
              )
            ),

            isOpen && (
              React.createElement('div', { className: "absolute right-0 mt-2 w-56 bg-white dark:bg-gray-800 rounded-lg shadow-xl z-50 overflow-hidden ring-1 ring-black dark:ring-gray-700 ring-opacity-5" },
                React.createElement('div', { className: "p-2" },
                  React.createElement('div', { className: "flex items-center p-2" },
                    React.createElement('img', { src: user.avatarUrl, alt: "User avatar", className: "w-12 h-12 rounded-full object-cover" }),
                    React.createElement('div', { className: "ml-3" },
                      React.createElement('p', { className: "font-semibold text-sm text-gray-800 dark:text-gray-100 truncate" }, user.name),
                      React.createElement('p', { className: "text-xs text-gray-500 dark:text-gray-400 truncate" }, user.email)
                    )
                  ),
                  React.createElement('div', { className: "border-t border-gray-100 dark:border-gray-700 my-1" }),
                  React.createElement('a', { href: "#", onClick: handleSettings, className: "block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md" }, "Settings"),
                  React.createElement('div', { className: "border-t border-gray-100 dark:border-gray-700 my-1" }),
                  React.createElement('a', { href: "#", onClick: handleLogout, className: "block px-4 py-2 text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-500/10 rounded-md" }, "Logout")
                )
              )
            )
          )
        );
      };

      // --- From components/Header.tsx ---
      const Logo = () => (
        React.createElement('div', { className: "flex items-center space-x-2" },
          React.createElement('div', { className: "w-8 h-8 bg-orange-500 rounded-lg flex items-center justify-center" },
            React.createElement('svg', { xmlns: "http://www.w3.org/2000/svg", className: "h-5 w-5 text-white", fill: "none", viewBox: "0 0 24 24", stroke: "currentColor" },
              React.createElement('path', { strokeLinecap: "round", strokeLinejoin: "round", strokeWidth: 2, d: "M13 10V3L4 14h7v7l9-11h-7z" })
            )
          ),
          React.createElement('span', { className: "font-bold text-xl text-gray-800 dark:text-gray-100" }, "User Profile")
        )
      );

      const Header = ({ user, theme, toggleTheme }) => {
        return (
          React.createElement('header', { className: "bg-white/70 dark:bg-gray-800/70 backdrop-blur-lg sticky top-0 z-20 shadow-sm" },
            React.createElement('div', { className: "container mx-auto px-4 sm:px-6 lg:px-8" },
              React.createElement('div', { className: "flex items-center justify-between h-16" },
                React.createElement(Logo),
                React.createElement('div', { className: "flex items-center space-x-4" },
                  React.createElement(ThemeToggle, { theme, toggleTheme }),
                  React.createElement(UserDropdown, { user })
                )
              )
            )
          )
        );
      };

      // --- From components/MainContent.tsx ---
      const FormInput = ({ id, label, type = 'text', value, onChange, required = false, disabled = false }) => (
        React.createElement('div', null,
          React.createElement('label', { htmlFor: id, className: "block text-sm font-medium text-gray-700 dark:text-gray-300" }, label),
          React.createElement('input', {
            type: type,
            name: id,
            id: id,
            value: value,
            onChange: onChange,
            className: "mt-1 block w-full border border-gray-300 dark:border-gray-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm bg-white dark:bg-gray-700 dark:text-white disabled:bg-gray-100 dark:disabled:bg-gray-800",
            required: required,
            disabled: disabled,
          })
        )
      );

      const FormSelect = ({ id, label, value, onChange, children, required = false }) => (
        React.createElement('div', null,
          React.createElement('label', { htmlFor: id, className: "block text-sm font-medium text-gray-700 dark:text-gray-300" }, label),
          React.createElement('select', {
            name: id,
            id: id,
            value: value,
            onChange: onChange,
            className: "mt-1 block w-full border border-gray-300 dark:border-gray-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm bg-white dark:bg-gray-700 dark:text-white",
            required: required
          }, children)
        )
      );

      const MainContent = ({ user, onSave }) => {
        const [formData, setFormData] = useState(user);
        const [isSaved, setIsSaved] = useState(false);

        useEffect(() => {
          setFormData(user);
        }, [user]);

        const handleChange = (e) => {
          const { name, value } = e.target;
          setFormData(prev => ({ ...prev, [name]: value }));
        };
        
        const handleSubmit = async (e) => {
          e.preventDefault();
          const { data, error } = await supabaseClient.auth.updateUser({
              data: {
                  full_name: formData.name,
                  phone: formData.phone,
                  gender: formData.gender,
                  country: formData.country,
                  dateOfBirth: formData.dateOfBirth
              }
          });

          if (error) {
              console.error("Error updating user:", error);
              alert("Failed to save changes: " + error.message);
          } else {
              onSave(data.user);
              setIsSaved(true);
              setTimeout(() => setIsSaved(false), 3000);
          }
        };


        return (
          React.createElement('div', { className: "max-w-4xl mx-auto" },
            React.createElement('div', { className: "bg-white dark:bg-gray-800 rounded-2xl shadow-lg overflow-hidden" },
              React.createElement('div', { className: "p-6 sm:p-8" },
                React.createElement('h1', { className: "text-2xl font-bold text-gray-900 dark:text-gray-100" }, "Profile Information"),
                React.createElement('p', { className: "mt-1 text-sm text-gray-600 dark:text-gray-400" }, "Update your personal details here.")
              ),
              React.createElement('form', { onSubmit: handleSubmit },
                React.createElement('div', { className: "p-6 sm:p-8 border-t border-gray-200 dark:border-gray-700" },
                  React.createElement('div', { className: "grid grid-cols-1 md:grid-cols-2 gap-6" },
                    React.createElement('div', { className: "md:col-span-2 flex items-center space-x-6" },
                       React.createElement('img', { src: formData.avatarUrl, alt: "User avatar", className: "w-20 h-20 rounded-full object-cover ring-2 ring-offset-2 ring-orange-200 dark:ring-offset-gray-800" }),
                       React.createElement('div', null,
                          React.createElement('h2', { className: "text-xl font-semibold dark:text-gray-100" }, formData.name),
                          React.createElement('p', { className: "text-gray-500 dark:text-gray-400" }, formData.email),
                          React.createElement('button', { type: "button", className: "mt-2 text-sm font-medium text-orange-600 hover:text-orange-500 dark:hover:text-orange-400 transition-colors" }, "Change Photo")
                       )
                    ),
                    
                    React.createElement(FormInput, { id: "name", label: "Full Name", value: formData.name, onChange: handleChange, required: true }),
                    React.createElement(FormInput, { id: "email", label: "Email Address", type: "email", value: formData.email, onChange: handleChange, required: true, disabled: true }),
                    React.createElement(FormInput, { id: "phone", label: "Phone Number", type: "tel", value: formData.phone, onChange: handleChange }),
                    React.createElement(FormInput, { id: "dateOfBirth", label: "Date of Birth", type: "date", value: formData.dateOfBirth, onChange: handleChange }),
                    
                    React.createElement(FormSelect, { id: "gender", label: "Gender", value: formData.gender, onChange: handleChange },
                      React.createElement('option', { value: "" }, "Select Gender"),
                      React.createElement('option', { value: "male" }, "Male"),
                      React.createElement('option', { value: "female" }, "Female"),
                      React.createElement('option', { value: "other" }, "Prefer not to say")
                    ),

                    React.createElement(FormSelect, { id: "country", label: "Country", value: formData.country, onChange: handleChange },
                      React.createElement('option', { value: "" }, "Select Country"),
                      countries.map(country => (
                        React.createElement('option', { key: country, value: country }, country)
                      ))
                    )
                  )
                ),
                React.createElement('div', { className: "bg-gray-50 dark:bg-gray-800/50 px-6 sm:px-8 py-4 flex items-center justify-end space-x-4 rounded-b-2xl" },
                  isSaved && React.createElement('p', { className: "text-sm text-green-600 dark:text-green-400 animate-pulse" }, "Changes saved successfully!"),
                  React.createElement('button', {
                    type: "submit",
                    className: "px-6 py-2 text-sm font-medium text-white bg-orange-500 border border-transparent rounded-lg shadow-sm hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500 transition-colors"
                  }, "Save Changes")
                )
              )
            )
          )
        );
      };

      // --- From App.tsx ---
      const App = () => {
        const [user, setUser] = useState(null);
        const [loading, setLoading] = useState(true);
        const [theme, setTheme] = useState('light');

        useEffect(() => {
          const checkUser = async () => {
            const { data: { user }, error } = await supabaseClient.auth.getUser();

            if (error || !user) {
              window.location.href = window.location.origin + "/Vionex-/login.html";
            } else {
              const profileData = {
                id: user.id,
                name: user.user_metadata.full_name || user.email.split('@')[0],
                email: user.email,
                avatarUrl: user.user_metadata.avatar_url || `https://picsum.photos/seed/${user.id}/200/200`,
                phone: user.user_metadata.phone || '',
                gender: user.user_metadata.gender || '',
                country: user.user_metadata.country || '',
                dateOfBirth: user.user_metadata.dateOfBirth || '',
              };
              setUser(profileData);
              setLoading(false);
            }
          };
          checkUser();
        }, []);

        useEffect(() => {
          const root = window.document.documentElement;
          root.classList.remove(theme === 'light' ? 'dark' : 'light');
          root.classList.add(theme);
        }, [theme]);

        const toggleTheme = () => {
          setTheme(prevTheme => (prevTheme === 'light' ? 'dark' : 'light'));
        };

        const handleUserUpdate = useCallback((updatedUser) => {
            const profileData = {
                id: updatedUser.id,
                name: updatedUser.user_metadata.full_name || updatedUser.email.split('@')[0],
                email: updatedUser.email,
                avatarUrl: updatedUser.user_metadata.avatar_url || `https://picsum.photos/seed/${updatedUser.id}/200/200`,
                phone: updatedUser.user_metadata.phone || '',
                gender: updatedUser.user_metadata.gender || '',
                country: updatedUser.user_metadata.country || '',
                dateOfBirth: updatedUser.user_metadata.dateOfBirth || '',
            };
            setUser(profileData);
            console.log("User data updated:", profileData);
        }, []);

        if (loading) {
          return React.createElement('div', { className: "bg-[#FBECE6] dark:bg-gray-900 min-h-screen flex items-center justify-center" }, 
            React.createElement('div', { className: "text-lg font-semibold text-gray-800 dark:text-gray-200" }, "Loading Profile...")
          );
        }

        return (
          React.createElement('div', { className: "bg-[#FBECE6] dark:bg-gray-900 min-h-screen text-gray-800 dark:text-gray-200 transition-colors duration-300" },
            React.createElement('div', { className: "flex flex-col" },
              React.createElement(Header, { user: user, theme: theme, toggleTheme: toggleTheme }),
              React.createElement('main', { className: "p-4 sm:p-6 lg:p-8 flex-1" },
                React.createElement(MainContent, { user: user, onSave: handleUserUpdate })
              )
            )
          )
        );
      };
      
      // --- From index.tsx ---
      const rootElement = document.getElementById('root');
      if (!rootElement) {
        throw new Error("Could not find root element to mount to");
      }

      const root = ReactDOM.createRoot(rootElement);
      root.render(
        React.createElement(React.StrictMode, null,
          React.createElement(App)
        )
      );
    </script>
  </body>
</html>
